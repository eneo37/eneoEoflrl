<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>게시판</title>
  <style>
      a#logo-link {
        position: absolute;
        top: 30px;
        left: 30px;
        z-index: 1000;
      }
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: 20px auto;
      padding: 0 10px;
      background-color: #f9f9f9;
    }
    h1 {
      text-align: center;
    }
    #board {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    textarea {
      width: 100%;
      padding: 8px;
      margin: 10px 0;
      font-size: 14px;
      box-sizing: border-box;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      margin-bottom: 20px;
    }
    .post {
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
    }
    .post small {
      color: #888;
    }
  </style>

  <!-- Firebase SDK (v8) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
</head>
<body>
   <a id="logo-link" href="index.html">
      <img src="logo.png" alt="로고" style="width:200px; height:auto;">
   </a> 
  <h1>게시판</h1>
  <div id="board">
    <textarea id="content" rows="5" placeholder="내용을 입력하세요"></textarea>
    <button id="save-btn">글 저장</button>

    <h2>글 목록</h2>
    <div id="posts"></div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA33Sih8DgMpA5T4x2_jq42P2vVVizsS3s",
      authDomain: "eneo-fa533.firebaseapp.com",
      projectId: "eneo-fa533",
      storageBucket: "eneo-fa533.appspot.com",
      messagingSenderId: "444724118614",
      appId: "1:444724118614:web:ee7e313326838e803267f7",
      measurementId: "G-JEG9QQP86S"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    const ADMIN_EMAIL = "dudaettaeligi@gmail.com";

    let editPostId = null;

    auth.onAuthStateChanged(user => {
      if (!user) {
        auth.signInAnonymously().catch(console.error);
      }
    });

    document.getElementById("save-btn").addEventListener("click", () => {
      if (editPostId) {
        updatePost();
      } else {
        savePost();
      }
    });

    function savePost() {
      const content = document.getElementById("content").value.trim();
      if (!content) {
        alert("내용을 입력하세요.");
        return;
      }

      const userEmail = auth.currentUser && auth.currentUser.email ? auth.currentUser.email : "익명";

      db.collection("posts").add({
        content: content,
        date: new Date(),
        userEmail: userEmail
      }).then(() => {
        clearForm();
      }).catch(error => {
        alert("저장 중 오류가 발생했습니다: " + error.message);
      });
    }

    function editPost(id, content) {
      if (!auth.currentUser || auth.currentUser.email !== ADMIN_EMAIL) {
        alert("수정 권한이 없습니다.");
        return;
      }
      editPostId = id;
      document.getElementById("content").value = content;
      document.getElementById("save-btn").textContent = "수정 완료";
    }

    function updatePost() {
      const content = document.getElementById("content").value.trim();
      if (!content) {
        alert("내용을 입력하세요.");
        return;
      }
      if (!editPostId) {
        alert("수정할 글이 선택되지 않았습니다.");
        return;
      }

      db.collection("posts").doc(editPostId).update({
        content: content,
        date: new Date()
      }).then(() => {
        clearForm();
        editPostId = null;
        document.getElementById("save-btn").textContent = "글 저장";
      }).catch(error => {
        alert("수정 중 오류가 발생했습니다: " + error.message);
      });
    }

    function deletePost(id) {
      if (!auth.currentUser || auth.currentUser.email !== ADMIN_EMAIL) {
        alert("삭제 권한이 없습니다.");
        return;
      }
      if (confirm("정말 삭제하시겠습니까?")) {
        db.collection("posts").doc(id).delete().catch(error => {
          alert("삭제 중 오류가 발생했습니다: " + error.message);
        });
      }
    }

    function clearForm() {
      document.getElementById("content").value = "";
    }

    db.collection("posts").orderBy("date", "desc").onSnapshot(snapshot => {
      const postsDiv = document.getElementById("posts");
      postsDiv.innerHTML = "";
      snapshot.forEach(doc => {
        const post = doc.data();
        const id = doc.id;
        const userEmail = post.userEmail || "익명";

        let postHTML = `
          <small>작성자: ${userEmail} | 작성일: ${post.date.toDate().toLocaleString()}</small>
          <p>${post.content}</p>
        `;

        if (auth.currentUser && auth.currentUser.email === ADMIN_EMAIL) {
          const safeContent = post.content.replace(/`/g, '\\`');

          postHTML += `
            <button onclick="editPost('${id}', \`${safeContent}\`)">수정</button>
            <button onclick="deletePost('${id}')">삭제</button>
          `;
        }

        const postElement = document.createElement("div");
        postElement.classList.add("post");
        postElement.innerHTML = postHTML;
        postsDiv.appendChild(postElement);
      });
    });
  </script>
</body>
</html>


